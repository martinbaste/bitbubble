<!DOCTYPE html>
<html>
<head>
	<title>Bitcoin Bubble Expected Value Calculator</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
</head>
<body>
<div class="container">
	<div class="row">
		<div class="col-md-12">
			<div class="card">
				<div class="card-body">
					<h1 class="card-title">Bitcoin Bubble Simulator</h1>
					<p>This calculator was inspired by this <a href="https://medium.freecodecamp.org/are-we-in-a-cryptocurrency-bubble-a-comparison-with-the-2000-dotcom-bubble-a463d8dd8d8b" target="_blank">awesome article</a> published by Jose Maria Macedo. Good read overall, if you are short on time scroll down to the expected value section.</p>
					<q>Given that there is evidence we’re in a bubble, and that it’s virtually impossible to time a bubble bursting, it seems wise to prepare ourselves. So what can we do? As a former professional poker player I like to think of things in terms of expected value or EV. EV is simply the sum of all possible values for a random variable, each value multiplied by its probability of occurrence</q>
					<p>Our plan here is to learn how to use expected value (EV) for our benefit. Enter your assumptions and calculate the EV of any course of action.</p>
					<p>I'm using Bitcoin here as our currency but of course it can be applied to anything.</p>
					<p>Here is how it works:</p>
					<ol>
						<li>Bitcoin is at an arbitrary value of $100.</li>
					<li>Two things can happen here: the price crashes or keeps growing.</li>
						<ol>
							<li>If it crashes, it goes down to the <code>crash price</code>.</li>
							<li>Then it goes to the <code>after-crash long term price</code>.</li>
						</ol>
						<li>If it doesn't crash, it goes to <code>post-crash long term price</code>.</li>
					</ol>
					<hr>
					<div>
						<h3>Price chart</h3>
						<svg id="chart" width="400" height="300"></svg>

					</div>
					<div>
						<h3>Assumptions</h3>
						<div>
					    	<label><strong>Starting price</strong></label><br/>
					    	$100
					    </div>
						<div>
					    	<label><strong>Price crash probability</strong></label><br/>
					    	<input type="range" min="0" max="100" value="80" id="probCrash" list="tickmarks"/>
					    	<span class="probCrash"></span>%
					    </div>
					    <div>
					    	<label><strong>Crash price</strong></label><br/>
					    	$<input type="number" value="30" id="crashPrice"/>
					    </div>
					    <div>
					    	<label><strong>Post-crash long term price</strong></label><br/>
					    	$<input type="number" value="150" id="postCrashLongTermPrice">
					    </div>
					    <div>
					    	<label><strong>No-crash long term price</strong></label><br/>
					    	$<input type="number" value="250" id="noCrashLongTermPrice">
					    </div>
					</div>
					<div>
						<h3>What to do?</h3>
						<div>
							<p>Total potential investment: $10,000</p>
					    	<label><strong>Amount to invest</strong></label><br/>
					    	<strong>$<span class="inv"></span></strong><input type="range" min="0" max="100" value="30" id="choose-invest" list="tickmarks"/><strong>$<span class="uninv"></span></strong>
					    	<span id="todo"></span>%
					    </div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-6">
			<div class="card">
			  <div class="card-body">
			  	<h3 class="card-title">Total invested: $<span class="inv"></span></h3>

			    <!-- <div>
			    	<label>Investment distribution</label><br/>
			    	<input type="range" min="0" max="100" value="50" id="split" list="tickmarks"/>
			    	<span id="splitDisplay"></span>%
			    </div> -->
			    <div>
			    	Expected profit if there is no crash: $<span class="invNoCrashEV"></span><br/>
			    	Expected loss if bitcoin crashes: $<span class="invCrashEV"></span><br/>
			    	Investment expected value: $<span class="invEV"></span>  ($<span class="invChange"></span>)
			    </div>
			  </div>
			</div>
		</div>
		<div class="col-md-6">
			<div class="card">
				<div class="card-body">
					<h3 class="card-title">Invested during crash: $<span class="uninv"></span></h3>
					<h4>Crash</h4>
					<p>Value if invested after crash. $<span class="uninvCrashEV"></span></p>
					<h4>No crash</h4>
					<p>If there is no crash, it remains uninvested. Value: $<span class="uninv"></span></p>
					<p>Opportunity cost. Value if invested: $<span class="uninv"></span> - $<span class="uninvIfInv"></span>: $<span class="uninvNoCrashEV"></span></p>
					<h4>EV for investment after bubble crash.</h4>
					<p>EV crash * p crash + EV no crash * p nocrash: <span class="uninvEV"></span></p>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<div class="card">
				<div class="card-body">
					<h2>Final Expected Value</h2>
					<p>EV initial investment + EV crash investment</p>
					<p class="h3">$<span class="finalEV"></span></p>
					<p>Final value if there is no crash (<span class="probNoCrash"></span>%): $<span class="finalNoCrashEV"></span></p>
					<p>Final value if there is crash (<span class="probCrash"></span>%): $<span class="finalCrashEV"></span></p>
				</div>
			</div>
		</div>
	</div>
</div>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.12.0/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
<script>

	var available = 10000;
	var initialPrice = 100;
	var inv = 10000;
	var uninv = 0;

	var probCrash = 0;
	var probNoCrash = 0;

	var crashPrice = 0;
	var postCrashLongTermPrice = 0;
	var noCrashLongTermPrice = 0;

	var invCrashEV = 0;
	var invNoCrashEV = 0;
	var invEV = 0;

	var uninvCrashEV = 0;
	var uninvNoCrashEV = 0;
	var uninvEV = 0;

	function setDisplay() {
		$(".probCrash").text(probCrash * 100);
		$(".probNoCrash").text(probNoCrash * 100);
		$("#growthDisplay").text($("#growth").val());
		$("#crashDisplay").text($("#crash").val());
		$("#splitDisplay").text($("#split").val());
	}

	function populateInv () {

		var initialBought = inv / initialPrice;

		invNoCrashEV = noCrashLongTermPrice * initialBought;

		invCrashEV = crashPrice * initialBought;

		invEV = (invNoCrashEV * (1 - probCrash)) + (invCrashEV * probCrash);

		var invChange = invEV - inv;

		$(".invNoCrashEV").text(invNoCrashEV.toLocaleString('en', {useGrouping:true}));
		$(".invCrashEV").text(invCrashEV.toLocaleString('en', {useGrouping:true}));
		$(".invEV").text(invEV.toLocaleString('en', {useGrouping:true}));
		$(".inv").text(inv.toLocaleString('en', {useGrouping:true}));
		$(".uninv").text(uninv.toLocaleString('en', {useGrouping:true}));
		
		/*if (invChange >= 0) {
			$("#profit-loss").text("profit");
		} else {
			invChange = -invChange;
			$("#profit-loss").text("loss");
		}*/
		$(".invChange").text(invChange.toLocaleString('en', {useGrouping:true}));
	}

	function populateUninv() {
		var boughtPostCrash = uninv / crashPrice;
		uninvCrashEV = boughtPostCrash * postCrashLongTermPrice;

		uninvIfInv = (uninv/initialPrice) * noCrashLongTermPrice;
		uninvNoCrashEV = uninv - uninvIfInv;

		uninvEV = uninvCrashEV * probCrash + uninvNoCrashEV * (1 - probCrash);

		$(".uninvCrashEV").text(uninvCrashEV.toLocaleString('en', {useGrouping:true}));
		$(".uninvIfInv").text(uninvIfInv.toLocaleString('en', {useGrouping:true}));
		$(".uninvNoCrashEV").text(uninvNoCrashEV.toLocaleString('en', {useGrouping:true}));
		$(".uninvEV").text(uninvEV.toLocaleString('en', {useGrouping:true}));

	}

	function populateFinal() {
		var finalEV = invEV + uninvEV;

		var finalCrashEV = invCrashEV + uninvCrashEV;
		var finalNoCrashEV = invNoCrashEV + uninvNoCrashEV;

		$(".finalEV").text(finalEV.toLocaleString('en', {useGrouping:true}));
		$(".finalCrashEV").text(finalCrashEV.toLocaleString('en', {useGrouping:true}));
		$(".finalNoCrashEV").text(finalNoCrashEV.toLocaleString('en', {useGrouping:true}));
	}

	function graph () {

		var parseTime = d3.timeParse("%d-%b-%y");

		var svg = d3.select("svg"),
		    margin = {top: 20, right: 20, bottom: 30, left: 50},
		    width = +svg.attr("width") - margin.left - margin.right,
		    height = +svg.attr("height") - margin.top - margin.bottom,
		    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	    var x = d3.scaleTime()
	        .rangeRound([0, width]);

	    var y = d3.scaleLinear()
	        .rangeRound([height, 0]);

	    var line = d3.line()
	        .x(function(d) { return x(parseTime(d.date)); })
	        .y(function(d) { return y(d.price); });

	    var data = [
	    	{date: "17-Dec-17", price: 100},
	    	{date: "17-Jan-18", price: 150},
	    	{date: "17-Jun-18", price: 30},
	    	{date: "17-Dec-18", price: 100}
	    ];

	    x.domain(d3.extent(data, function(d) { return parseTime(d.date); }));
  		y.domain(d3.extent(data, function(d) { return d.price; }));

  		g.append("g")
		      .attr("transform", "translate(0," + height + ")")
		      .call(d3.axisBottom(x))
		    .select(".domain")
		      .remove();

		g.append("g")
			  .call(d3.axisLeft(y))
			.append("text")
			  .attr("fill", "#000")
			  .attr("transform", "rotate(-90)")
			  .attr("y", 6)
			  .attr("dy", "0.71em")
			  .attr("text-anchor", "end")
			  .text("Price ($)");

		g.append("path")
		      .datum(data)
		      .attr("fill", "none")
		      .attr("stroke", "steelblue")
		      .attr("stroke-linejoin", "round")
		      .attr("stroke-linecap", "round")
		      .attr("stroke-width", 1.5)
		      .attr("d", line);

	}

	function updateGlobals() {
		available = 10000;

		var invSlider = $("#choose-invest").val();
		inv = ((100-invSlider)/100)*available;
		uninv = available - inv;

		probCrash = Math.round($("#probCrash").val())/100;
		probNoCrash = Math.round(100 - $("#probCrash").val())/100;

		crashPrice = $("#crashPrice").val();
		postCrashLongTermPrice = $("#postCrashLongTermPrice").val();
		noCrashLongTermPrice = $("#noCrashLongTermPrice").val();
	}

	function update() {
		updateGlobals();
		//graph();
		populateInv();
		populateUninv();
		populateFinal();
		setDisplay();

	}

	//$("#choose-invest").change(update)

	$("input").change(update);
	$("select").change(update);
	update();

</script>
</body>
</html>
